From 2b725dd1c50ef852c7ae55cc1d2c408cc8480152 Mon Sep 17 00:00:00 2001
From: Dirk Neukirchen <dirkneukirchen@web.de>
Date: Sat, 2 May 2015 10:14:51 +0200
Subject: [PATCH 7/7] mac80211: add patch from Hauke

Signed-off-by: Dirk Neukirchen <dirkneukirchen@web.de>
---
 .../patches/999-backport_include_kernel_4_1.patch  | 32 ++++++++++++++++++++++
 1 file changed, 32 insertions(+)
 create mode 100644 package/kernel/mac80211/patches/999-backport_include_kernel_4_1.patch

diff --git a/package/kernel/mac80211/patches/999-backport_include_kernel_4_1.patch b/package/kernel/mac80211/patches/999-backport_include_kernel_4_1.patch
new file mode 100644
index 0000000..c416de5
--- /dev/null
+++ b/package/kernel/mac80211/patches/999-backport_include_kernel_4_1.patch
@@ -0,0 +1,32 @@
+From 750bc46cfbd5f97558a5f89c5b7ed1b041412ab4 Mon Sep 17 00:00:00 2001
+From: Hauke Mehrtens <hauke@hauke-m.de>
+Date: Fri, 1 May 2015 11:17:24 +0200
+Subject: [PATCH] header: add possible_{write,read}_pnet() on kernel >= 4.1
+
+backports only adds the possible_{write,read}_pnet() functions for
+kernel < 4.1. This results in a compile error on kernel 4.1. This patch
+make it use the original functions on these kernel versions. This fixes
+a problem introduced in 3d418885971.
+
+Signed-off-by: Hauke Mehrtens <hauke@hauke-m.de>
+---
+ backport/backport-include/net/net_namespace.h | 3 +++
+ 1 file changed, 3 insertions(+)
+
+diff --git a/backport/backport-include/net/net_namespace.h b/backport/backport-include/net/net_namespace.h
+index 90c044f..b202120 100644
+--- a/backport-include/net/net_namespace.h
++++ b/backport-include/net/net_namespace.h
+@@ -57,6 +57,9 @@ static inline struct net *possible_read_pnet(const possible_net_t *pnet)
+ 	return &init_net;
+ #endif
+ }
++#else
++#define possible_write_pnet(pnet, net) write_pnet(pnet, net)
++#define possible_read_pnet(pnet) write_pnet(pnet)
+ #endif /* LINUX_VERSION_CODE < KERNEL_VERSION(4,1,0) */
+ 
+ #endif	/* _COMPAT_NET_NET_NAMESPACE_H */
+-- 
+1.9.1
+
-- 
2.3.7

